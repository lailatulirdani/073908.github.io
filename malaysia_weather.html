<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Malaysia Weather Monitoring</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: linear-gradient(to right, #1e3c72, #2a5298);
      color: white;
      font-family: 'Segoe UI', sans-serif;
      padding: 1rem;
    }

    .card-glass {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      backdrop-filter: blur(10px);
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      margin-bottom: 2rem;
    }

    .weather-icon img {
      width: 80px;
    }

    select, button {
      border-radius: 10px;
    }

    canvas {
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      margin-top: 1.5rem;
    }

    @media (max-width: 576px) {
      canvas {
        min-width: 100%;
      }
    }

    .chart-container {
      overflow-x: auto;
    }

    .text-white {
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card-glass">
      <h2 class="text-center mb-4">üå¶Ô∏è Malaysia Weather Monitoring</h2>
      <div class="d-flex flex-column flex-md-row align-items-center justify-content-center gap-3">
        <select class="form-select w-100 w-md-auto" id="citySelect">
          <option disabled selected>Pilih Bandar</option>
          <option value="Kuala Lumpur">Kuala Lumpur</option>
          <option value="George Town">George Town</option>
          <option value="Johor Bahru">Johor Bahru</option>
          <option value="Kota Kinabalu">Kota Kinabalu</option>
          <option value="Kuching">Kuching</option>
          <option value="Ipoh">Ipoh</option>
          <option value="Shah Alam">Shah Alam</option>
          <option value="Malacca">Malacca</option>
        </select>
        <button class="btn btn-light" onclick="getWeather()">üîç Cari</button>
      </div>

      <div id="weatherResult" class="text-center mt-4">
        <p>Sila pilih bandar untuk lihat ramalan cuaca.</p>
      </div>

      <div class="chart-container">
        <canvas id="hourlyChart"></canvas>
      </div>

      <div class="chart-container">
        <canvas id="dailyChart"></canvas>
      </div>

      <div class="text-center mt-4">
        <a href="index.html" class="btn btn-outline-light">üîô Kembali ke Dashboard</a>
      </div>
    </div>
  </div>

  <script>
    const apiKey = "f7e9df249fc00b82cf885c146d590a95";
    let hourlyChart, dailyChart;

    async function getWeather() {
      const city = document.getElementById("citySelect").value;
      if (!city) return;

      const currentUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city},MY&units=metric&appid=${apiKey}`;
      const forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${city},MY&units=metric&appid=${apiKey}`;

      try {
        const resCurrent = await fetch(currentUrl);
        const dataCurrent = await resCurrent.json();

        if (dataCurrent.cod !== 200) {
          document.getElementById("weatherResult").innerHTML = `<p>‚ö†Ô∏è ${dataCurrent.message}</p>`;
          return;
        }

        document.getElementById("weatherResult").innerHTML = `
          <div class="weather-icon">
            <img src="https://openweathermap.org/img/wn/${dataCurrent.weather[0].icon}@2x.png" alt="icon">
          </div>
          <h4 class="mt-2">${dataCurrent.name}</h4>
          <p>üå°Ô∏è ${dataCurrent.main.temp} ¬∞C | üíß ${dataCurrent.main.humidity}% | üå¨Ô∏è ${dataCurrent.wind.speed} m/s</p>
          <p>‚òÅÔ∏è ${dataCurrent.weather[0].description}</p>
        `;

        await loadHourlyChart(city);
        await loadDailyChart(city);
      } catch (error) {
        document.getElementById("weatherResult").innerHTML = "<p>‚ö†Ô∏è Masalah mendapatkan data. Sila cuba lagi.</p>";
      }
    }

    async function loadHourlyChart(city) {
      const url = `https://api.openweathermap.org/data/2.5/forecast?q=${city},MY&units=metric&appid=${apiKey}`;
      const res = await fetch(url);
      const data = await res.json();

      const times = data.list.slice(0, 8).map(i => i.dt_txt.split(" ")[1].slice(0,5));
      const temps = data.list.slice(0, 8).map(i => i.main.temp);

      const ctx = document.getElementById("hourlyChart").getContext("2d");
      if (hourlyChart) hourlyChart.destroy();

      hourlyChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: times,
          datasets: [{
            label: "Suhu Jam Ini (¬∞C)",
            data: temps,
            backgroundColor: "rgba(54, 162, 235, 0.6)",
            borderRadius: 8,
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: `Ramalan Suhu Setiap Jam (${city})`,
              color: "#fff",
              font: {
                size: 16
              }
            },
            legend: { labels: { color: "#fff" } },
            tooltip: {
              callbacks: {
                label: context => `${context.parsed.y} ¬∞C`
              }
            }
          },
          scales: {
            x: { ticks: { color: "#fff" } },
            y: { ticks: { color: "#fff" }, beginAtZero: true }
          }
        }
      });
    }

    async function loadDailyChart(city) {
      const url = `https://api.openweathermap.org/data/2.5/forecast?q=${city},MY&units=metric&appid=${apiKey}`;
      const res = await fetch(url);
      const data = await res.json();

      const dailyTemps = {};
      data.list.forEach(item => {
        const date = item.dt_txt.split(" ")[0];
        if (!dailyTemps[date]) dailyTemps[date] = [];
        dailyTemps[date].push(item.main.temp);
      });

      const dates = Object.keys(dailyTemps).slice(0, 5);
      const avgTemps = dates.map(d => {
        const sum = dailyTemps[d].reduce((a,b) => a + b, 0);
        return (sum / dailyTemps[d].length).toFixed(1);
      });

      const ctx = document.getElementById("dailyChart").getContext("2d");
      if (dailyChart) dailyChart.destroy();

      dailyChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: dates,
          datasets: [{
            label: "Purata Suhu Harian (¬∞C)",
            data: avgTemps,
            borderColor: "rgba(255, 206, 86, 1)",
            backgroundColor: "rgba(255, 206, 86, 0.2)",
            tension: 0.4,
            pointBackgroundColor: "white",
            fill: true,
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: `Ramalan Suhu 5 Hari (${city})`,
              color: "#fff",
              font: { size: 16 }
            },
            legend: { labels: { color: "#fff" } },
            tooltip: {
              callbacks: {
                label: context => `${context.parsed.y} ¬∞C`
              }
            }
          },
          scales: {
            x: { ticks: { color: "#fff" } },
            y: { ticks: { color: "#fff" }, beginAtZero: false }
          }
        }
      });
    }
  </script>
</body>
</html>
